from flask import Flask, request, render_template_string, render_template, session
import urllib
import crud

app = Flask(__name__)
app.secret_key = 'session_secret_key'

# 파일 업로드를 위한 HTML 폼을 보여줍니다.
@app.route('/', methods=['GET'])
@app.route('/index.html', methods=['GET'])
def home():
    return render_template('index.html')

# 파일 업로드를 처리합니다.
@app.route('/upload', methods=['POST'])
def sendFile():
    file = request.files['file']
    if file:
        name, data, content, pre_time = crud.unzipfile(file)
        session['data'] = data
        dist, cal_time = crud.cal_similarity(content)
        ward_data, ward_time = crud.ward_dist(dist, name)
        session['ward_data'] = ward_data
        single_time = crud.single_dist(dist)
        dendro_data = crud.make_dendrogram(ward_data)
        print(session.get('ward_data'))
        print(dendro_data)
        return render_template('upload.html', content=content, pre_time=pre_time, num=len(content), cal_time=cal_time,
                               ward_time=ward_time, single_time=single_time)
    return "No file uploaded"

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
